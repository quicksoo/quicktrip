# QuickTrip 部署指南

## 环境准备

### 1. 开发环境
- **HBuilderX**: 最新版本
- **微信开发者工具**: 最新稳定版
- **Node.js**: >= 14.0.0

### 2. 账号准备
- **微信小程序账号**: 在微信公众平台注册
- **腾讯云账号**: 开通云开发服务

## 部署步骤

### 第一步：配置小程序基本信息

1. **获取小程序AppID**
   - 登录微信公众平台
   - 进入小程序管理后台
   - 复制AppID

2. **配置manifest.json**
   ```json
   {
     "mp-weixin": {
       "appid": "你的小程序AppID",
       "setting": {
         "urlCheck": false
       }
     }
   }
   ```

### 第二步：配置云开发环境

1. **创建云开发环境**
   - 在HBuilderX中右键项目根目录
   - 选择"创建uniCloud云开发环境"
   - 选择"腾讯云"
   - 按提示完成环境创建

2. **配置云函数**
   ```bash
   # 右键 cloudfunctions-aliyun 文件夹
   # 选择"关联云服务空间或项目"
   # 选择刚创建的云开发环境
   ```

### 第三步：部署云函数

1. **上传getScenicSpots云函数**
   ```bash
   # 右键 cloudfunctions-aliyun/getScenicSpots
   # 选择"上传并部署"
   ```

2. **上传submitFeedback云函数**
   ```bash
   # 右键 cloudfunctions-aliyun/submitFeedback  
   # 选择"上传并部署"
   ```

### 第四步：初始化数据库

1. **创建数据库集合**
   - 进入腾讯云控制台
   - 找到云开发环境
   - 进入数据库管理
   - 创建以下集合：
     - `scenic_spots` (景点数据)
     - `user_feedback` (用户反馈)

2. **导入初始数据**
   ```javascript
   // 参考 database/init.js 中的数据结构
   // 手动添加一些测试数据
   ```

3. **设置数据库权限**
   ```javascript
   // scenic_spots 集合权限设置为：仅读
   // user_feedback 集合权限设置为：仅创建
   ```

### 第五步：本地调试

1. **在HBuilderX中运行**
   - 选择"运行" -> "运行到小程序模拟器" -> "微信开发者工具"
   - 确保微信开发者工具已安装并登录

2. **测试功能**
   - 测试城市切换
   - 测试景点搜索
   - 测试用户反馈提交
   - 测试小程序跳转（需要真机测试）

### 第六步：发布小程序

1. **生成发行版本**
   ```bash
   # 在HBuilderX中选择"发行" -> "小程序-微信"
   # 填写版本号和更新说明
   # 点击发行
   ```

2. **上传代码**
   - 代码会自动上传到微信公众平台
   - 登录微信公众平台查看版本管理

3. **提交审核**
   - 在微信公众平台选择刚上传的版本
   - 填写审核信息
   - 提交审核

4. **发布上线**
   - 审核通过后点击发布
   - 小程序正式上线

## 配置检查清单

### 必须配置项
- [ ] 小程序AppID已配置
- [ ] 云开发环境已创建
- [ ] 云函数已上传部署
- [ ] 数据库集合已创建
- [ ] 数据库权限已设置

### 可选配置项
- [ ] 小程序基本信息完善
- [ ] 小程序头像和介绍设置
- [ ] 服务类目选择
- [ ] 用户隐私保护指引

## 常见问题

### 1. 云函数调用失败
**问题**: 提示"云函数不存在"
**解决**: 
- 检查云函数是否正确上传
- 确认云函数名称拼写正确
- 检查云开发环境是否正确关联

### 2. 数据库权限错误
**问题**: 提示"权限不足"
**解决**:
- 检查数据库集合权限设置
- 确认用户登录状态
- 检查云函数中的数据库操作权限

### 3. 小程序跳转失败
**问题**: 无法跳转到其他小程序
**解决**:
- 确认在真机环境测试
- 检查shortLink格式是否正确
- 确认目标小程序是否存在

### 4. 审核被拒
**常见原因**:
- 缺少用户协议和隐私政策
- 功能描述不清晰
- 测试账号信息不完整

**解决方案**:
- 完善小程序信息
- 添加必要的法律文档
- 提供详细的测试说明

## 监控和维护

### 1. 云函数监控
- 定期查看云函数调用日志
- 监控云函数执行时间和错误率
- 及时处理异常情况

### 2. 数据库维护
- 定期备份重要数据
- 清理过期的反馈数据
- 优化数据库查询性能

### 3. 用户反馈处理
- 及时处理用户提交的景点信息
- 定期更新景点数据
- 回复用户问题和建议

## 更新发布

### 版本更新流程
1. 修改代码
2. 测试功能
3. 更新版本号
4. 重新发行
5. 提交审核
6. 发布上线

### 云函数更新
- 修改云函数代码后需要重新上传部署
- 数据库结构变更需要谨慎处理
- 重要更新建议先在测试环境验证

---

**注意**: 部署过程中如遇到问题，请参考官方文档或联系技术支持。